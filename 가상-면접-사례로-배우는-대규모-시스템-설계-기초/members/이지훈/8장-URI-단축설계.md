# URL Shortener 관점에서 본 HTTP 301 / 302 Redirect 설계

URL Shortener 서비스의 본질

* 짧은 URL을 발급한다
* 해당 URL로 접근하면 원래 URL로 이동시킨다

하지만 이 이동을 어떤 방식으로 하느냐에 따라 시스템의 성격은 완전히 달라진다.
HTTP 301 / 302 Redirect를 단축 URL 관점에서 어떻게 바라봐야 하는지에 따라 설계는 달라진다.

---

## 2. Redirect는 어디서 일어나는가

먼저 반드시 구분해야 할 것이 있다.

Redirect는 서버 내부 로직이 아니라 HTTP 응답에 대한 브라우저의 동작이다.

서버가 하는 일은 단 하나다.

```
HTTP/1.1 301 Moved Permanently
Location: https://example.com
```

혹은

```
HTTP/1.1 302 Found
Location: https://example.com
```

캐시할지 말지는 서버가 결정하지 않는다.
브라우저, CDN, 프록시가 각자의 정책으로 판단한다.

---

## 3. 공통 전제: 최초 요청은 무조건 서버를 거친다

301이든 302든 상관없이 최초 요청은 반드시 redirect 서버에 도달한다.

```
Client → Shortener Server → Redirect Response
```

따라서

* 최초 클릭 로그
* 최초 접근 IP
* 최초 User-Agent

는 301에서도 수집 가능하다.

차이는 그 다음 요청부터 발생한다.

---

## 4. 301 Redirect — Permanent

### 4.1 의미

301은 클라이언트에게 다음 메시지를 전달한다.

> 이 URL은 영구적으로 다른 주소로 이동했다

이 의미는 단순하다.

* 다음부터 이 URL로 다시 올 필요가 없다
* Location에 적힌 주소를 기억해도 된다

---

### 4.2 단축 URL에서의 실제 동작

첫 요청:

```
Client → A(shortener) → 301 → B(original)
```

두 번째 요청부터:

```
Client → B (직접 접근)
```

중요한 점은

> 두 번째 요청부터는 **A 서버로 요청 자체가 오지 않는다**

는 것이다.

A 서버는 해당 사용자의 재방문을 영원히 알 수 없다.

---

### 4.3 장점

* 네트워크 hop 감소
* latency 감소
* 서버 부하 감소
* SEO canonical 확정

한마디로 정리하면 중간 단계가 감소한다!

대규모 트래픽 환경에서는 이 장점이 매우 크다.

---

### 4.4 단점 

#### 1) 관측 불가능 (Observability Loss)

* 재방문 횟수
* 실제 총 클릭 수
* 시간대별 트래픽
* 사용자 행동 분석

이 모든 것이 불완전해진다.

특히 공유 프록시 / CDN 캐시 환경에서는 클릭 수가 심각하게 왜곡된다.

#### 2) 통제권 상실

* 목적지 URL 변경 불가
* A/B 테스트 불가
* 악성 URL 차단 불가
* 정책 적용 불가

한 번 캐시된 301은 사실상 되돌릴 수 없다.

#### 3) MSA / Gateway 구조 붕괴

A 서버가 Gateway 역할을 한다면,
301은 클라이언트에게 이렇게 말하는 것과 같다.

> 다음부터 Gateway 거치지 말고 바로 뒤로 가라

이는 인증, 보안, 트래픽 제어 측면에서 매우 위험해보인다.

---

## 5. 302 Redirect — Temporary

### 5.1 의미

302는 다음 메시지를 전달한다.

> 지금은 다른 곳으로 가지만, 이 URL은 여전히 유효하다

즉, 다음에도 다시 서버에 물어보라!

---

### 5.2 단축 URL에서의 실제 동작

모든 요청:

```
Client → A(shortener) → 302 → B(original)
```

항상 서버를 경유한다.

---

### 5.3 장점

#### 1) 완전한 트래픽 관측

* 정확한 클릭 수
* 재방문율
* 지역 / 디바이스 통계
* 캠페인 성과 측정

URL Shortener는 사실상 **데이터 서비스**이기 때문에 이 점이 핵심이다.

#### 2) 통제권 유지

* 목적지 변경 가능
* 실험(A/B Test) 가능
* 보안 차단 가능
* 정책 적용 가능

#### 3) 운영 리스크 감소

잘못 배포해도 롤백 가능하다.

---

### 5.4 단점

* 모든 요청이 서버를 경유
* 서버 비용 증가
* latency 증가

하지만 대부분의 상용 URL Shortener는 이 비용을 감수한다.

---


### 오해 1: 301이면 서버 부하가 없다

X

* 최초 요청은 항상 서버에 온다
* 신규 사용자, 신규 디바이스는 계속 유입된다
* 캐시 무효 상황은 항상 존재한다

301은 부하 제거가 아니라 부하 감소 전략이다.

---

### 오해 2: 301은 Redis, 302는 DB

완전히 다른 레이어다.

* Redis / DB: 저장소 선택 문제
* 301 / 302: HTTP 정책 문제

301이든 302든 URL lookup은 동일하게 필요하다.

---

## 7. URL Shortener에서의 선택 기준

### 301을 선택해야 하는 경우

* 절대 변경되지 않는 URL
* SEO canonical 목적
* 도메인 영구 이전
* http → https 전환

"앞으로도 절대 바뀌지 않는다"는 확신이 있을 때만 사용해야 한다.

---

### 302를 선택해야 하는 경우

* 단축 URL 서비스
* 마케팅 링크
* 트래픽 분석이 중요한 경우
* 실험 환경
* 보안 통제가 필요한 경우

대부분의 URL Shortener는 여기에 해당한다.

---

## 8. 핵심 트레이드오프

301과 302의 선택은 기술 문제가 아니다.

```
301 → 성능 최적화
302 → 통제 및 데이터 최적화
```

이는 곧 비즈니스 전략 선택이다.

---


## 10. 왜 구글은 301을 적극적으로 사용할까

301은 통제권을 일부 포기하는 선택임에도 불구하고, 구글은 특정 영역에서 매우 적극적으로 301을 사용한다. 이는 단순 기술 선택이 아니라 **인터넷 규모의 트래픽을 다루는 회사가 내리는 전략적 결정**이다.

### 1) 인터넷 전체의 latency(지연율)를 줄이기 위해

구글의 트래픽 규모는 일반 서비스와 비교할 수 없다.

Redirect hop 하나가 줄어들면:

* 전세계 수십억 요청에서 RTT(Round Trip Time : 왕복 시간이라고함) 감소
* 네트워크 비용 절감
* 사용자 체감 속도 개선

즉 301은 단순 최적화가 아니라 글로벌 인프라 효율화 전략에 가깝다.

---

### 2) Canonical URL을 강제하기 위해

검색엔진에서 가장 중요한 것 중 하나는 "정답 URL"을 확정하는 것이다.

예를 들어 다음 URL들은 모두 같은 페이지를 가리킬 수 있다.

```
http://google.com
https://google.com
www.google.com
google.com
```

이 상태를 방치하면 검색엔진 입장에서 중복 페이지가 된다.

그래서 구글은 다음처럼 강하게 확정한다.

```
http → https (301)
```

이것은 단순 redirect가 아니라 웹 생태계의 표준을 정리하는 행위다.

---

### 3) 구글은 URL을 거의 바꾸지 않는다

301의 가장 큰 리스크는 "되돌리기 어렵다"는 것이다.

하지만 구글의 핵심 경로는 수십 년 단위로 유지된다.

```
google.com/search
```

이런 경로는 바뀔 가능성이 극도로 낮다.

즉 구글은 **"절대 바뀌지 않을 URL"에만 301을 사용한다.**

---

### 4) Redirect 로그에 의존하지 않는다

대부분의 URL Shortener는 클릭 데이터를 수집하기 위해 302를 선호한다.

하지만 구글은 다르다.

이미 다양한 데이터 채널을 보유하고 있다.

* Chrome
* Android
* Google Analytics
* 광고 SDK
* DNS 수준 데이터

즉 redirect에서 추가 로그를 확보할 필요성이 상대적으로 낮다.

그래서 통제보다 속도와 표준화를 선택할 수 있다.

---

## 정리

> 데이터가 부족한 서비스는 302를 선택하고,
> 데이터가 충분한 서비스는 301로 속도를 선택할 수 있다.

Redirect 전략은 결국 기술 문제가 아니라 서비스가 무엇을 더 중요하게 보느냐의 문제다.